#!/bin/sh

databaseName=$1
directory=$2

echo $databaseName >> /home/lgiles/esp2/cgi-bin/config
echo $directory >> /home/lgiles/esp2/cgi-bin/config

mkdir -p $directory

sqlite3 $directory/db <<!

PRAGMA foreign_keys = ON;

CREATE TABLE location (
    locationId INTEGER PRIMARY KEY,
    locationName VARCHAR NOT NULL UNIQUE,
    locationHidden ENUM(0,1) DEFAULT 0
);
INSERT INTO location (locationName) VALUES ('receiving');

CREATE TABLE user (
    userId INTEGER PRIMARY KEY,
    userName VARCHAR NOT NULL UNIQUE,
    userPassword VARCHAR NOT NULL,
    userHidden NOT NULL DEFAULT 0,
    userType NOT NULL DEFAULT 1
);
INSERT INTO user (userName,userPassword,userType) VALUES ('admin','changeme',2);

CREATE TABLE bin (
    binId INTEGER PRIMARY KEY,
    binName VARCHAR NOT NULL UNIQUE,
    binSlots INTEGER NOT NULL,
    binHidden NOT NULL DEFAULT 0,
    locationId INTEGER NOT NULL REFERENCES location(locationId)
);
INSERT INTO bin (binName,binSlots,locationId) VALUES ('arrived',0,1);

CREATE TABLE tag (
    tagId INTEGER PRIMARY KEY,
    tagName VARCHAR NOT NULL UNIQUE,
    tagHidden ENUM(0,1) DEFAULT 0
);

!

# userType is..
# 0 = readonly
# 1 = normal
# 2 = admin

#chown apache:apache $directory
#chown apache:apache $directory/db
chmod 777 $directory
chmod 777 $directory/db
